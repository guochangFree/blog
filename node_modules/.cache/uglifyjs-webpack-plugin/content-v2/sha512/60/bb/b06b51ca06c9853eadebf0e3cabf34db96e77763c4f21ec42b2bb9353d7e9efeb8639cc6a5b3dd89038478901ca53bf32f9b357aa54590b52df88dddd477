{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{174:function(t,n,s){\"use strict\";s.r(n);var a=[function(){var t=this,n=t.$createElement,a=t._self._c||n;return a(\"div\",{staticClass:\"content\"},[a(\"h1\",{attrs:{id:\"spring源码分析\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#spring源码分析\",\"aria-hidden\":\"true\"}},[t._v(\"#\")]),t._v(\" Spring源码分析\")]),t._v(\" \"),a(\"h2\",{attrs:{id:\"深入理解spring-bean生命周期\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#深入理解spring-bean生命周期\",\"aria-hidden\":\"true\"}},[t._v(\"#\")]),t._v(\" 深入理解spring Bean生命周期\")]),t._v(\" \"),a(\"h3\",{attrs:{id:\"一个简单的注入bean的example\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#一个简单的注入bean的example\",\"aria-hidden\":\"true\"}},[t._v(\"#\")]),t._v(\" 一个简单的注入Bean的example\")]),t._v(\" \"),a(\"p\",[t._v(\"下面是一个简单的注册Bean的程序\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-java extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[a(\"code\",[a(\"span\",{attrs:{class:\"token annotation punctuation\"}},[t._v(\"@Configuration\")]),t._v(\"\\n\"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"class\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token class-name\"}},[t._v(\"LifeCycleExample\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\n    \"),a(\"span\",{attrs:{class:\"token annotation punctuation\"}},[t._v(\"@Bean\")]),t._v(\"\\n    \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" ExampleBeanA \"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"exampleBeanA\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n        \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"return\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"new\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token class-name\"}},[t._v(\"ExampleBeanA\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token string\"}},[t._v('\"ExampleBeanA instance\"')]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n    \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\\n    \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"class\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token class-name\"}},[t._v(\"ExampleBeanA\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n        \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" String name\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n        \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"ExampleBeanA\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"String name\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n            \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"this\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"name \"),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" name\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n        \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n        \"),a(\"span\",{attrs:{class:\"token annotation punctuation\"}},[t._v(\"@Override\")]),t._v(\"\\n        \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" String \"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"toString\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n            \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"return\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token string\"}},[t._v('\"ExampleBeanA{\"')]),t._v(\" \"),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"+\")]),t._v(\"\\n                    \"),a(\"span\",{attrs:{class:\"token string\"}},[t._v('\"name=\\'\"')]),t._v(\" \"),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"+\")]),t._v(\" name \"),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"+\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token string\"}},[t._v(\"'\\\\''\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"+\")]),t._v(\"\\n                    \"),a(\"span\",{attrs:{class:\"token string\"}},[t._v(\"'}'\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n        \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n    \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\\n    \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"static\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"void\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"main\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"String\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"[\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"]\")]),t._v(\" args\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\n        AnnotationConfigApplicationContext context \"),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"new\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token class-name\"}},[t._v(\"AnnotationConfigApplicationContext\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"LifeCycleExample\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"class\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n        ExampleBeanA bean \"),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" context\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"getBean\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"ExampleBeanA\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"class\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n        System\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"out\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"println\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"bean\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n    \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),a(\"div\",{staticClass:\"language- extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[t._v(\"ExampleBeanA{name='ExampleBeanA instance'}\\n\")])])]),a(\"p\",[t._v(\"上面的代码中，@Bean注解向容器中添加了一个ExampleBeanA的实例。\")]),t._v(\" \"),a(\"h3\",{attrs:{id:\"spring基础知识\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#spring基础知识\",\"aria-hidden\":\"true\"}},[t._v(\"#\")]),t._v(\" Spring基础知识\")]),t._v(\" \"),a(\"p\",[t._v(\"在翻看源码了解整个注册过程之前我们先了解几个\\nSpring基础知识。\")]),t._v(\" \"),a(\"ul\",[a(\"li\",[t._v(\"Spring使用 BeanDefinition 来描述一个拥有哪些属性，哪些构造方法参数和包括进一步具体实现信息的的bean的实例。\\n所以 BeanDefinition 这可以说是抽象了Spring Bean的数据结构。我们注册的bean都将经历从 spring 创建相应\\n的 BeanDefinition 到创建具体的实例。下图描述BeanDefinition的部分继承。\")])]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:s(!function(){var t=new Error(\"Cannot find module './img/BeanDefinition.png'\");throw t.code=\"MODULE_NOT_FOUND\",t}()),alt:\"An image\"}})]),t._v(\" \"),a(\"ul\",[a(\"li\",[t._v(\"Spring经典的startup method -- AbstractApplicationContext#refresh\")])]),t._v(\" \"),a(\"div\",{staticClass:\"language-java extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[a(\"code\",[a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"void\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"refresh\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"throws\")]),t._v(\" BeansException\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" IllegalStateException \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\t\\t\"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"synchronized\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"this\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"startupShutdownMonitor\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// Prepare this context for refreshing.\")]),t._v(\"\\n\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"prepareRefresh\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// Tell the subclass to refresh the internal bean factory.\")]),t._v(\"\\n\\t\\t\\tConfigurableListableBeanFactory beanFactory \"),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"obtainFreshBeanFactory\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// Prepare the bean factory for use in this context.\")]),t._v(\"\\n\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"prepareBeanFactory\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"beanFactory\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"try\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// Allows post-processing of the bean factory in context subclasses.\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"postProcessBeanFactory\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"beanFactory\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// Invoke factory processors registered as beans in the context.\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"invokeBeanFactoryPostProcessors\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"beanFactory\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// Register bean processors that intercept bean creation.\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"registerBeanPostProcessors\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"beanFactory\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// Initialize message source for this context.\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"initMessageSource\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// Initialize event multicaster for this context.\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"initApplicationEventMulticaster\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// Initialize other special beans in specific context subclasses.\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"onRefresh\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// Check for listener beans and register them.\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"registerListeners\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// Instantiate all remaining (non-lazy-init) singletons.\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"finishBeanFactoryInitialization\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"beanFactory\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// Last step: publish corresponding event.\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"finishRefresh\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\\n\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"catch\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token class-name\"}},[t._v(\"BeansException\")]),t._v(\" ex\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"if\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"logger\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"isWarnEnabled\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\t\\t\\t\\t\\tlogger\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"warn\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token string\"}},[t._v('\"Exception encountered during context initialization - \"')]),t._v(\" \"),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"+\")]),t._v(\"\\n\\t\\t\\t\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token string\"}},[t._v('\"cancelling refresh attempt: \"')]),t._v(\" \"),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"+\")]),t._v(\" ex\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// Destroy already created singletons to avoid dangling resources.\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"destroyBeans\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// Reset 'active' flag.\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"cancelRefresh\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"ex\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// Propagate exception to caller.\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"throw\")]),t._v(\" ex\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\\n\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"finally\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// Reset common introspection caches in Spring's core, since we\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// might not ever need metadata for singleton beans anymore...\")]),t._v(\"\\n\\t\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"resetCommonCaches\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\t\\t\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\\t\\t\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\\t\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),a(\"ul\",[a(\"li\",[t._v(\"Spring内置的BeanPostProcessor\\nSpring内置了一些很有用的BeanPostProcessor接口实现类。比如有AutowiredAnnotationBeanPostProcessor、\\nRequiredAnnotationBeanPostProcessor、CommonAnnotationBeanPostProcessor、\\nEventListenerMethodProcessor等。这些Processor会处理各自的场景。\\n正是有了这些processor，把bean的构造过程中的一部分功能分配给了这些processor处理，减轻了BeanFactory的负担。\\n读者现在可以不用了解这些processor的用途，下图中，在调用\"),a(\"code\",[t._v(\"register(annotatedClasses)\")]),t._v(\"和\"),a(\"code\",[t._v(\"refresh()\")]),t._v(\"方法之前，\\n已经载入了多个BeanPostProcessor。下面我将向大家描述spring容器启动时候，如何载入某些内置的processor。\")])]),t._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:s(!function(){var t=new Error(\"Cannot find module './img/internalBeanPostProcessor.png'\");throw t.code=\"MODULE_NOT_FOUND\",t}()),alt:\"An image\"}})]),t._v(\" \"),a(\"blockquote\",[a(\"p\",[t._v(\"【注意】不同的\"),a(\"code\",[t._v(\"ApplicationContext\")]),t._v(\"内置的\"),a(\"code\",[t._v(\"BeanPostProcessor\")]),t._v(\"不同。\")])]),t._v(\" \"),a(\"p\",[t._v(\"针对本章节内容我们主要讲解图片中的\"),a(\"code\",[t._v(\"org.springframework.context.annotation.internalConfigurationAnnotationProcessor\")]),t._v(\"\\n对应的class为\"),a(\"code\",[t._v(\"ConfigurationClassPostProcessor\")]),t._v(\",下面\"),a(\"code\",[t._v(\"ConfigurationClassPostProcessor\")]),t._v(\"的部分继承关系。\\n\")]),a(\"div\",{attrs:{align:\"center\"}},[a(\"img\",{attrs:{src:s(!function(){var t=new Error(\"Cannot find module './img/configurationClassPostProcessor.png'\");throw t.code=\"MODULE_NOT_FOUND\",t}()),width:\"350px\"}})]),a(\"p\"),t._v(\" \"),a(\"p\",[a(\"code\",[t._v(\"AnnotationConfigApplicationContext\")]),t._v(\"的构造方法调用链如下,执行结束时候已经向容器中载入\"),a(\"code\",[t._v(\"ConfigurationClassPostProcessor\")]),t._v(\"\\n的\"),a(\"code\",[t._v(\"BeanDefinition\")]),t._v(\",具体代码在\"),a(\"code\",[t._v(\"AnnotationConfigUtils.registerAnnotationConfigProcessors(this.registry);\")]),t._v(\"即下图的最后\\n一个步骤。\\n\")]),a(\"div\",{attrs:{align:\"center\"}},[a(\"img\",{attrs:{src:s(!function(){var t=new Error(\"Cannot find module './img/registInternalConfiguraionBeanPostProcessor.png'\");throw t.code=\"MODULE_NOT_FOUND\",t}()),width:\"400px\"}})]),a(\"p\"),t._v(\" \"),a(\"div\",{staticClass:\"language-java extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[a(\"code\",[a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"public\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"static\")]),t._v(\" Set\"),a(\"span\",{attrs:{class:\"token generics function\"}},[a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"<\")]),t._v(\"BeanDefinitionHolder\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\" \"),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"registerAnnotationConfigProcessors\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"\\n\\t\\t\\tBeanDefinitionRegistry registry\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token annotation punctuation\"}},[t._v(\"@Nullable\")]),t._v(\" Object source\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\n        \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"\\n\\n\\t\\tSet\"),a(\"span\",{attrs:{class:\"token generics function\"}},[a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"<\")]),t._v(\"BeanDefinitionHolder\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\">\")])]),t._v(\" beanDefs \"),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"new\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token class-name\"}},[t._v(\"LinkedHashSet\")]),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"<\")]),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\">\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token number\"}},[t._v(\"8\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n        \"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// org.springframework.context.annotation.internalConfigurationAnnotationProcessor\")]),t._v(\"\\n\\t\\t\"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"if\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"!\")]),t._v(\"registry\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"containsBeanDefinition\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\t\\t\\tRootBeanDefinition def \"),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"new\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token class-name\"}},[t._v(\"RootBeanDefinition\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"ConfigurationClassPostProcessor\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"class\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\t\\tdef\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"setSource\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"source\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\t\\tbeanDefs\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"add\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"registerPostProcessor\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"registry\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" def\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\t\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\\n        \"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// org.springframework.context.annotation.internalConfigurationBeanNameGenerator\")]),t._v(\"\\n\\t\\t\"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"if\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"!\")]),t._v(\"registry\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"containsBeanDefinition\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\t\\t\\tRootBeanDefinition def \"),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"new\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token class-name\"}},[t._v(\"RootBeanDefinition\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"AutowiredAnnotationBeanPostProcessor\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"class\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\t\\tdef\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"setSource\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"source\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\t\\tbeanDefs\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"add\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"registerPostProcessor\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"registry\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" def\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\t\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\\n\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// Check for JSR-250 support, and if present add the CommonAnnotationBeanPostProcessor.\")]),t._v(\"\\n\\t\\t\"),a(\"span\",{attrs:{class:\"token comment\"}},[t._v(\"// org.springframework.context.annotation.internalCommonAnnotationProcessor\")]),t._v(\"\\n\\t\\t\"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"if\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"jsr250Present \"),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"&&\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"!\")]),t._v(\"registry\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"containsBeanDefinition\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"COMMON_ANNOTATION_PROCESSOR_BEAN_NAME\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n\\t\\t\\tRootBeanDefinition def \"),a(\"span\",{attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"new\")]),t._v(\" \"),a(\"span\",{attrs:{class:\"token class-name\"}},[t._v(\"RootBeanDefinition\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"CommonAnnotationBeanPostProcessor\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"class\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\t\\tdef\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"setSource\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"source\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\t\\tbeanDefs\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"add\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{attrs:{class:\"token function\"}},[t._v(\"registerPostProcessor\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"registry\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" def\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" COMMON_ANNOTATION_PROCESSOR_BEAN_NAME\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\\t\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\\n\\t\\t\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"\\n\\n\\t\\t\"),a(\"span\",{attrs:{class:\"token keyword\"}},[t._v(\"return\")]),t._v(\" beanDefs\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\t\"),a(\"span\",{attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),a(\"p\",[t._v(\"到这里读者应该明白为什么在\"),a(\"code\",[t._v(\"refresh()\")]),t._v(\"方法执行之前容器中已经载入过多个BeanDefinition，而且这些BeanDefinition大多对应\\n某个processor，尤其是\"),a(\"code\",[t._v(\"ConfigurationClassPostProcessor\")]),t._v(\"对@Bean注解向spring容器注册bean信息起着至关作用的作用。\")])])}],o=s(0),e=Object(o.a)({},function(){this.$createElement;this._self._c;return this._m(0)},a,!1,null,null,null);e.options.__file=\"README.md\";n.default=e.exports}}]);","extractedComments":[]}